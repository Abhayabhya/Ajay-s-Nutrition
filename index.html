<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajay's Nutrition - Fuel Your Ambition</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Razorpay Checkout Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        /* Hide scrollbar for cleaner look */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Cart transition */
        #cart-sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .category-btn.active, .size-btn.active {
            background-color: #06b6d4;
            color: white;
            border-color: #06b6d4;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- Main Shop View (Grid) -->
    <div id="shop-view">
        <!-- Header -->
        <header id="home" class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-50">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between gap-4">
                  <a href="#home" class="flex items-center flex-shrink-0">
  <img src="logo.png" alt="Ajay's Nutrition Logo" class="h-12 w-auto mr-2">
  <span class="text-3xl font-bold text-cyan-400">Ajay's Nutrition</span>
</a>
                    <div class="relative w-full max-w-xs hidden md:block">
                        <input type="text" id="search-bar" placeholder="Search products..." class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        <i data-lucide="search" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                    </div>
                    <div class="flex items-center">
                        <nav class="hidden lg:flex items-center space-x-6 mr-6">
                            <a href="#products" class="text-gray-300 hover:text-cyan-400 transition duration-300">Products</a>
                            <a href="#about" class="text-gray-300 hover:text-cyan-400 transition duration-300">About Us</a>
                            <a href="#contact" class="text-gray-300 hover:text-cyan-400 transition duration-300">Contact</a>
                            <a href="#authenticity" class="text-gray-300 hover:text-cyan-400 transition duration-300">Authenticity</a>
                            <a href="#return-policy" class="text-gray-300 hover:text-cyan-400 transition duration-300">Return Policy</a>
                            <a href="#" id="my-orders-link" class="text-gray-300 hover:text-cyan-400 transition duration-300">My Orders</a>
                        </nav>
                        <button id="cart-button" class="relative text-gray-300 hover:text-cyan-400 transition duration-300">
                            <i data-lucide="shopping-cart"></i>
                            <span id="cart-count" class="absolute -top-2 -right-2 bg-cyan-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                        </button>
                        <button id="mobile-menu-button" class="lg:hidden text-gray-300 hover:text-cyan-400 ml-4">
                           <i data-lucide="menu"></i>
                        </button>
                    </div>
                </div>
                  <!-- Mobile Menu -->
                <div id="mobile-menu" class="hidden lg:hidden mt-4">
                    <div class="relative w-full my-4 md:hidden">
                        <input type="text" id="mobile-search-bar" placeholder="Search products..." class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        <i data-lucide="search" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                    </div>
                    <a href="#products" class="mobile-menu-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-800 rounded">Products</a>
                    <a href="#about" class="mobile-menu-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-800 rounded">About Us</a>
                    <a href="#contact" class="mobile-menu-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-800 rounded">Contact</a>
                    <a href="#authenticity" class="mobile-menu-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-800 rounded">Authenticity</a>
                    <a href="#return-policy" class="mobile-menu-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-800 rounded">Return Policy</a>
                    <a href="#" id="mobile-my-orders-link" class="mobile-menu-link block py-2 px-4 text-sm text-gray-300 hover:bg-gray-800 rounded">My Orders</a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <section class="hero-bg h-[calc(100vh-80px)] flex items-center justify-center">
                <div class="text-center px-6">
                    <h1 class="text-4xl md:text-6xl lg:text-7xl font-extrabold text-white leading-tight mb-4">
                        <span class="text-cyan-400">Fuel</span> Your Ambition
                    </h1>
                    <p class="text-lg md:text-xl text-gray-300 max-w-2xl mx-auto mb-8">
                        Authentic, high-quality supplements to help you achieve your peak performance. Your fitness journey starts here.
                    </p>
                    <a href="#products" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-4 px-10 rounded-lg shadow-xl transition duration-300 transform hover:scale-105 text-lg">
                        Explore Products
                    </a>
                </div>
            </section>

            <section id="products" class="py-20 bg-gray-900">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl md:text-4xl font-bold text-white">Featured Products</h2>
                        <p class="text-gray-400 mt-2">Top picks from our curated selection.</p>
                        <div class="w-24 h-1 bg-cyan-500 mx-auto mt-4 rounded"></div>
                    </div>
                    <div id="category-filters" class="flex flex-wrap justify-center gap-2 md:gap-4 mb-12">
                          <!-- Category buttons will be inserted here -->
                    </div>
                    <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <!-- Skeletons will be shown while products load -->
                    </div>
                </div>
            </section>

            <section id="about" class="py-20 bg-gray-800">
                <div class="container mx-auto px-6">
                    <div class="max-w-3xl mx-auto text-center">
                        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">About Ajay's Nutrition</h2>
                        <div class="w-24 h-1 bg-cyan-500 mx-auto mb-6 rounded"></div>
                        <p class="text-gray-300 mb-4 leading-relaxed">Welcome to Ajay's Nutrition! My name is Ajay Thakur, and my passion for fitness led me to open this store. I was tired of seeing overpriced, fake supplements flood the market. My mission is simple: to provide 100% genuine, lab-tested supplements at a fair price.</p>
                    </div>
                </div>
            </section>

             <section id="contact" class="py-20 bg-gray-900">
                 <div class="container mx-auto px-6">
                     <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-white">Get In Touch</h2><p class="text-gray-400 mt-2">Visit us or drop us a line. We're here to help!</p><div class="w-24 h-1 bg-cyan-500 mx-auto mt-4 rounded"></div></div>
                     <div class="flex flex-col lg:flex-row gap-8">
                         <div class="lg:w-1/2 bg-gray-800 p-8 rounded-lg">
                             <h3 class="text-2xl font-bold text-white mb-6">Contact Information</h3>
                             <div class="space-y-6">
                                 <div class="flex items-start space-x-4"><i data-lucide="map-pin" class="text-cyan-400 mt-1 flex-shrink-0"></i><div><h4 class="font-semibold text-white">Our Location</h4><p class="text-gray-400">VIP Rd, Kaurin Bhatha, Basantpur, Rajnandgaon, Chhattisgarh 491441</p></div></div>
                                 <div class="flex items-start space-x-4"><i data-lucide="phone" class="text-cyan-400 mt-1 flex-shrink-0"></i><div><h4 class="font-semibold text-white">Call Us</h4><p class="text-gray-400">+9198274 05400</p></div></div>
                                 <div class="flex items-start space-x-4"><i data-lucide="mail" class="text-cyan-400 mt-1 flex-shrink-0"></i><div><h4 class="font-semibold text-white">Email Us</h4><p class="text-gray-400">contact@ajaysnutrition.com</p></div></div>
                             </div>
                         </div>
                         <div class="lg:w-1/2 h-96 lg:h-auto rounded-lg overflow-hidden"><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3368.835768876093!2d81.01828997471591!3d21.085251485836864!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3a294591ded720ef%3A0xdd8ec695a1c18c5c!2sAjay&#39;s%20Nutrition!5e1!3m2!1sen!2sin!4v1756532635873!5m2!1sen!2sin" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div>
                     </div>
                 </div>
             </section>

            <section id="authenticity" class="py-20 bg-gray-800">
                <div class="container mx-auto px-6">
                    <div class="max-w-3xl mx-auto">
                        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4 text-center">Verify Your Product</h2>
                        <div class="w-24 h-1 bg-cyan-500 mx-auto mb-8 rounded"></div>
                        <div class="text-gray-300 space-y-4 leading-relaxed bg-gray-800 p-8 rounded-lg">
                            <p>At Ajay's Nutrition, we guarantee 100% authenticity. Every product you buy from us is sourced directly from the brands or their official importers. We encourage you to verify your purchase to ensure your peace of mind.</p>
                            <h4 class="text-xl font-semibold text-white pt-4">How to Verify:</h4>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong>Check the Seal:</strong> Every genuine product comes with a factory-sealed cap and an inner seal. Do not accept the product if the seal is broken.</li>
                                <li><strong>Scratch & Verify Code:</strong> Most major brands include a unique scratch code on the product packaging. You can visit the brand's official website and enter this code to verify authenticity instantly.</li>
                                <li><strong>Importer's Sticker:</strong> Look for the official importer's sticker on the product. This sticker contains crucial information, including the import date and FSSAI license number.</li>
                                <li><strong>Contact Us:</strong> If you have any doubts about your product, please do not hesitate to contact our customer support with your order details and product images. We are here to help you.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section id="return-policy" class="py-20 bg-gray-900">
                <div class="container mx-auto px-6">
                    <div class="max-w-3xl mx-auto">
                        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4 text-center">Return Policy</h2>
                        <div class="w-24 h-1 bg-cyan-500 mx-auto mb-8 rounded"></div>
                        <div class="text-gray-300 space-y-4 leading-relaxed">
                            <p>We have a 7-day return policy, which means you have 7 days after receiving your item to request a return.</p>
                            <p>To be eligible for a return, your item must be in the same condition that you received it, unopened, with the seal intact, and in its original packaging. You’ll also need the receipt or proof of purchase.</p>
                            <p>To start a return, you can contact us at contact@ajaysnutrition.com. If your return is accepted, we’ll send you instructions on how and where to send your package. Items sent back to us without first requesting a return will not be accepted.</p>
                            <h4 class="text-xl font-semibold text-white pt-4">Damages and issues</h4>
                            <p>Please inspect your order upon reception and contact us immediately if the item is defective, damaged or if you receive the wrong item, so that we can evaluate the issue and make it right.</p>
                             <h4 class="text-xl font-semibold text-white pt-4">Refunds</h4>
                            <p>We will notify you once we’ve received and inspected your return, and let you know if the refund was approved or not. If approved, you’ll be automatically refunded on your original payment method. Please remember it can take some time for your bank or credit card company to process and post the refund too.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="bg-gray-800 border-t border-gray-700">
            <div class="container mx-auto px-6 py-8">
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <div class="text-center md:text-left mb-4 md:mb-0">
                        <a href="#home" class="text-xl font-bold text-cyan-400">Ajay's Nutrition</a>
                        <p class="text-gray-400 mt-2">© 2024 Ajay's Nutrition. All Rights Reserved.</p>
                        <div class="mt-4 text-sm space-x-4">
                            <a href="#" class="text-gray-400 hover:text-cyan-400">Terms of Service</a>
                            <a href="#" class="text-gray-400 hover:text-cyan-400">Privacy Policy</a>
                            <a href="#authenticity" class="text-gray-400 hover:text-cyan-400">Authenticity</a>
                            <a href="#return-policy" class="text-gray-400 hover:text-cyan-400">Return Policy</a>
                        </div>
                    </div>
                    <div class="flex items-center space-x-6">
                        <a href="#" id="admin-login-link" class="text-gray-400 hover:text-cyan-400 transition duration-300">Admin</a>
                        <a href="https://www.instagram.com/ajaysnutrition?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" target="_blank" class="text-gray-400 hover:text-cyan-400 transition duration-300"><i data-lucide="instagram"></i></a>
                        <a href="https://www.facebook.com/share/1XHcCQH1ye/" target="_blank" class="text-gray-400 hover:text-cyan-400 transition duration-300"><i data-lucide="facebook"></i></a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Product Detail View -->
    <div id="product-detail-view" class="hidden min-h-screen bg-gray-900 text-white p-4 sm:p-6 lg:p-8">
        <div class="container mx-auto">
            <button id="back-to-products-grid" class="flex items-center gap-2 text-cyan-400 font-semibold mb-8"><i data-lucide="arrow-left"></i> Back to Products</button>
            <div id="product-detail-content" class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12">
                 <!-- Product details will be dynamically injected here -->
            </div>
        </div>
    </div>

    <!-- Customer Panel View -->
    <div id="customer-view" class="hidden min-h-screen bg-gray-900 text-white p-4 sm:p-6 lg:p-8">
        <div class="container mx-auto">
            <div id="customer-lookup-screen">
                <div class="max-w-md mx-auto mt-20">
                    <div class="bg-gray-800 p-8 rounded-lg shadow-xl">
                        <h2 class="text-2xl font-bold text-center text-cyan-400 mb-6">Track Your Orders</h2>
                        <form id="customer-lookup-form">
                            <div class="mb-4">
                                <label for="customerLookupEmail" class="block text-gray-300 mb-2">Enter your email to find your orders</label>
                                <input type="email" id="customerLookupEmail" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500" required>
                            </div>
                            <p id="customer-lookup-error" class="text-red-500 text-sm mb-4 hidden">No orders found for this email.</p>
                            <button type="submit" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Find Orders</button>
                        </form>
                        <button id="back-to-shop-3" class="w-full mt-4 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Back to Shop</button>
                    </div>
                </div>
            </div>
            <div id="customer-orders-screen" class="hidden">
                 <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-8">
                     <h1 class="text-3xl font-bold text-cyan-400">Your Orders</h1>
                     <div>
                        <button id="lookup-another-email-btn" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 mr-2">Check Another Email</button>
                        <button id="back-to-shop-4" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Back to Shop</button>
                     </div>
                 </div>
                 <div id="customer-order-list" class="space-y-4 max-h-[70vh] overflow-y-auto no-scrollbar">
                     <!-- Orders will be rendered here -->
                 </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel View -->
    <div id="admin-view" class="hidden min-h-screen bg-gray-900 text-white p-4 sm:p-6 lg:p-8">
        <div id="login-screen" class="max-w-md mx-auto mt-20">
            <div class="bg-gray-800 p-8 rounded-lg shadow-xl"><h2 class="text-2xl font-bold text-center text-cyan-400 mb-6">Admin Login</h2><form id="login-form"><div class="mb-4"><label for="password" class="block text-gray-300 mb-2">Password</label><input type="password" id="password" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500" required></div><p id="login-error" class="text-red-500 text-sm mb-4 hidden">Incorrect password.</p><button type="submit" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Login</button></form><button id="back-to-shop-1" class="w-full mt-4 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Back to Shop</button></div>
        </div>
        <div id="admin-dashboard" class="hidden">
            <div class="flex flex-wrap justify-between items-center gap-4 mb-8">
                <h1 class="text-3xl font-bold text-cyan-400">Admin Dashboard</h1>
                <div>
                    <button id="back-to-shop-2" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 mr-2">Back to Shop</button>
                    <button id="logout-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Logout</button>
                </div>
            </div>
            <!-- Admin Tabs -->
            <div class="mb-8 border-b border-gray-700">
                <nav class="flex space-x-4" aria-label="Tabs">
                    <button id="tab-products" class="tab-btn text-cyan-400 border-b-2 border-cyan-400 px-3 py-2 font-medium">Products</button>
                    <button id="tab-orders" class="tab-btn text-gray-400 hover:text-white px-3 py-2 font-medium">Orders</button>
                </nav>
            </div>

            <!-- Products Tab Content -->
            <div id="content-products">
                 <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-4">
                        <h2 class="text-xl font-semibold">Manage Products</h2>
                        <button id="add-new-product-btn" class="w-full sm:w-auto bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Add New Product</button>
                    </div>
                    <div id="admin-product-list" class="space-y-4 max-h-[60vh] overflow-y-auto no-scrollbar"><p class="text-gray-400">Loading products...</p></div>
                </div>
            </div>

            <!-- Orders Tab Content -->
            <div id="content-orders" class="hidden">
                 <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4">Recent Orders</h2>
                    <div id="admin-order-list" class="space-y-4 max-h-[70vh] overflow-y-auto no-scrollbar"><p class="text-gray-400">Loading orders...</p></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="admin-product-modal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden items-center justify-center p-4">
         <!-- Add/Edit Product Form will be injected here -->
    </div>
    <div id="admin-variant-modal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden items-center justify-center p-4">
         <!-- Add/Edit Variant Form will be injected here -->
    </div>


    <!-- Shopping Cart Sidebar -->
    <div id="cart-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden"></div>
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full max-w-md bg-gray-800 text-white shadow-lg z-50 transform translate-x-full"><div class="flex flex-col h-full"><div class="flex justify-between items-center p-6 border-b border-gray-700"><h2 class="text-2xl font-bold text-cyan-400">Your Cart</h2><button id="close-cart-button" class="text-gray-400 hover:text-white"><i data-lucide="x"></i></button></div><div id="cart-items" class="flex-grow p-6 overflow-y-auto no-scrollbar"></div><div class="p-6 border-t border-gray-700 bg-gray-800"><div class="flex justify-between items-center mb-4"><span class="text-lg font-semibold">Subtotal</span><span id="cart-subtotal" class="text-xl font-bold text-cyan-400">₹0</span></div><button id="checkout-button" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 rounded-lg transition duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed">Proceed to Checkout</button></div></div></div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden items-center justify-center p-4"><div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-lg p-8 relative"><button id="close-checkout-button" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x"></i></button><h2 class="text-2xl font-bold text-cyan-400 mb-6">Checkout</h2><form id="checkout-form" class="space-y-4"><div><label for="customerName" class="block text-sm font-medium text-gray-300">Full Name</label><input type="text" id="customerName" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white px-3 py-2" required></div><div><label for="customerEmail" class="block text-sm font-medium text-gray-300">Email</label><input type="email" id="customerEmail" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white px-3 py-2" required></div><div><label for="customerPhone" class="block text-sm font-medium text-gray-300">Phone Number</label><input type="tel" id="customerPhone" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white px-3 py-2" required></div><div class="pt-4"><div class="flex justify-between items-center text-lg"><span>Total Amount:</span><span id="checkout-total" class="font-bold text-cyan-400 text-xl">₹0</span></div></div><button type="submit" id="pay-button" class="w-full mt-6 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition duration-300">Pay Securely</button></form></div></div>
    
    <!-- Custom Confirmation Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
            <h3 id="confirm-title" class="text-lg font-bold text-white mb-4">Are you sure?</h3>
            <p id="confirm-text" class="text-gray-300 mb-6">This action cannot be undone.</p>
            <div class="flex justify-center gap-4">
                <button id="confirm-cancel" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg">Cancel</button>
                <button id="confirm-ok" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg">Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-green-500 text-white py-2 px-5 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300"></div>

    <!-- Main Application Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc, serverTimestamp, query, orderBy, where, getDocs, getDoc, setDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- IMPORTANT: FIREBASE CONFIGURATION ---
        const firebaseConfig = {
          apiKey: "AIzaSyD6WMcQB-hwRtORwFYkQD1tbQxihLi8_NI",
          authDomain: "ajay-s-nutrition.firebaseapp.com",
          projectId: "ajay-s-nutrition",
          storageBucket: "ajay-s-nutrition.firebasestorage.app",
          messagingSenderId: "859946452081",
          appId: "1:859946452081:web:65aa593f47e85862d207d0",
          measurementId: "G-KL537177V8"
        };
        
        // --- INITIALIZATION ---
        let app, auth, db;
        
        // --- DOM ELEMENTS ---
        const productGrid = document.getElementById('product-grid');
        const adminProductList = document.getElementById('admin-product-list');
        const adminOrderList = document.getElementById('admin-order-list');
        const cartItemsContainer = document.getElementById('cart-items');
        const cartCount = document.getElementById('cart-count');
        const cartSubtotal = document.getElementById('cart-subtotal');
        const checkoutButton = document.getElementById('checkout-button');
        const checkoutTotal = document.getElementById('checkout-total');
        const mobileMenu = document.getElementById('mobile-menu');
        const categoryFilters = document.getElementById('category-filters');
        const searchBar = document.getElementById('search-bar');
        const mobileSearchBar = document.getElementById('mobile-search-bar');
        const tabProducts = document.getElementById('tab-products');
        const tabOrders = document.getElementById('tab-orders');
        const contentProducts = document.getElementById('content-products');
        const contentOrders = document.getElementById('content-orders');
        const customerLookupScreen = document.getElementById('customer-lookup-screen');
        const customerOrdersScreen = document.getElementById('customer-orders-screen');
        const customerOrderList = document.getElementById('customer-order-list');
        const productDetailContent = document.getElementById('product-detail-content');

        // --- APP STATE ---
        let productsCollection, ordersCollection;
        let cart = [];
        let allProducts = [];
        let currentCategory = 'All';
        let currentSearchTerm = '';
        let currentProductVariants = [];

        // --- UI & VIEW MANAGEMENT ---
        const switchView = (viewName, data = null) => {
            ['shop-view', 'admin-view', 'customer-view', 'product-detail-view'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
             window.scrollTo(0, 0);

            if (viewName === 'product-detail-view' && data && data.productId) {
                renderProductDetail(data.productId);
            }
            
            document.getElementById(viewName).classList.remove('hidden');
        };

        const showLoginScreen = () => { document.getElementById('login-screen').classList.remove('hidden'); document.getElementById('admin-dashboard').classList.add('hidden'); };
        const showDashboard = () => { document.getElementById('login-screen').classList.add('hidden'); document.getElementById('admin-dashboard').classList.remove('hidden'); };
        const openCart = () => { document.getElementById('cart-overlay').classList.remove('hidden'); document.getElementById('cart-sidebar').classList.remove('translate-x-full'); };
        const closeCart = () => { document.getElementById('cart-overlay').classList.add('hidden'); document.getElementById('cart-sidebar').classList.add('translate-x-full'); };
        const openCheckout = () => { if (cart.length === 0) return; const subtotal = calculateSubtotal(); checkoutTotal.textContent = `₹${subtotal.toLocaleString('en-IN')}`; document.getElementById('checkout-modal').classList.remove('hidden'); document.getElementById('checkout-modal').classList.add('flex'); };
        const closeCheckout = () => { document.getElementById('checkout-modal').classList.add('hidden'); document.getElementById('checkout-modal').classList.remove('flex'); };
        
        const showToast = (message, isError = false) => {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `fixed bottom-5 right-5 text-white py-2 px-5 rounded-lg shadow-lg transform transition-all duration-300 ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            toast.classList.remove('opacity-0', 'translate-y-20');
            setTimeout(() => { toast.classList.add('opacity-0', 'translate-y-20'); }, 3000);
        };

        const confirmAction = ({ title, text }) => {
            return new Promise((resolve) => {
                const modal = document.getElementById('confirm-modal');
                document.getElementById('confirm-title').textContent = title;
                document.getElementById('confirm-text').textContent = text;
                modal.classList.remove('hidden'); modal.classList.add('flex');
                const okBtn = document.getElementById('confirm-ok');
                const cancelBtn = document.getElementById('confirm-cancel');
                const cleanup = () => {
                    modal.classList.add('hidden'); modal.classList.remove('flex');
                    okBtn.replaceWith(okBtn.cloneNode(true));
                    cancelBtn.replaceWith(cancelBtn.cloneNode(true));
                };
                okBtn.addEventListener('click', () => { cleanup(); resolve(true); });
                cancelBtn.addEventListener('click', () => { cleanup(); resolve(false); });
            });
        };

        // --- CART LOGIC ---
        const calculateSubtotal = () => cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
        
        const updateCart = () => {
            cartItemsContainer.innerHTML = '';
            let totalItems = 0;
            if (cart.length === 0) { cartItemsContainer.innerHTML = `<p class="text-gray-400 text-center">Your cart is empty.</p>`; } 
            else {
                cart.forEach(item => {
                    totalItems += item.quantity;
                    const el = document.createElement('div');
                    el.className = 'flex items-center justify-between gap-4 py-3 border-b border-gray-700';
                    el.innerHTML = `
                        <img src="${item.imageUrl}" alt="${item.name}" class="w-20 h-20 object-cover rounded-md">
                        <div class="flex-grow">
                            <p class="font-semibold text-white">${item.name}</p>
                            <p class="text-xs text-gray-300">${item.flavour} / ${item.size}</p>
                            <p class="text-sm text-gray-400 mt-1">₹${item.price.toLocaleString('en-IN')}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="quantity-change text-cyan-400" data-id="${item.variantId}" data-change="-1">-</button>
                            <span>${item.quantity}</span>
                            <button class="quantity-change text-cyan-400" data-id="${item.variantId}" data-change="1">+</button>
                        </div>
                        <button class="remove-item text-red-400 hover:text-red-500" data-id="${item.variantId}"><i data-lucide="trash-2" class="w-5 h-5"></i></button>`;
                    cartItemsContainer.appendChild(el);
                });
            }
            cartSubtotal.textContent = `₹${calculateSubtotal().toLocaleString('en-IN')}`;
            cartCount.textContent = totalItems;
            checkoutButton.disabled = cart.length === 0;
            lucide.createIcons();
        };

        const addToCart = (variant) => { 
            if (!variant.inStock) {
                showToast('This item is out of stock.', true);
                return;
            }
            const existingItem = cart.find(item => item.variantId === variant.id); 
            if (existingItem) { existingItem.quantity++; } 
            else { cart.push({ 
                variantId: variant.id, 
                productId: variant.productId,
                name: variant.productName,
                imageUrl: variant.productImageUrl,
                size: variant.size,
                flavour: variant.flavour,
                price: variant.price,
                quantity: 1 
            }); } 
            showToast('Item added to cart!'); 
            updateCart(); 
        };
        const changeQuantity = (variantId, change) => { const item = cart.find(i => i.variantId === variantId); if (item) { item.quantity += change; if (item.quantity <= 0) { cart = cart.filter(i => i.variantId !== variantId); } updateCart(); } };
        const removeFromCart = (variantId) => { cart = cart.filter(i => i.variantId !== variantId); updateCart(); };

        // --- PRODUCT RENDERING & FILTERING ---
        const renderShopProducts = (products) => {
            productGrid.innerHTML = '';
            if (products.length === 0) { productGrid.innerHTML = `<p class="text-gray-400 col-span-full text-center">No products match your search.</p>`; return; }
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = "bg-gray-800 rounded-lg overflow-hidden shadow-lg flex flex-col cursor-pointer hover:ring-2 hover:ring-cyan-500 transition-all duration-300";
                card.dataset.id = product.id;
                const priceString = product.minPrice ? `From ₹${product.minPrice.toLocaleString('en-IN')}` : 'View Options';
                
                card.innerHTML = `
                    <div class="relative">
                        <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-56 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x400/1f2937/FFFFFF?text=Image+Error';">
                    </div>
                    <div class="p-6 flex flex-col flex-grow">
                        <h3 class="text-xl font-semibold text-white mb-2">${product.name}</h3>
                        <p class="text-gray-400 text-sm flex-grow">${product.category}</p>
                        <div class="mt-4">
                            <span class="text-xl font-bold text-cyan-400">${priceString}</span>
                        </div>
                    </div>`;
                card.addEventListener('click', () => switchView('product-detail-view', { productId: product.id }));
                productGrid.appendChild(card);
            });
            lucide.createIcons();
        };

        const renderProductDetail = async (productId) => {
            productDetailContent.innerHTML = `<div class="col-span-full text-center text-gray-400">Loading product...</div>`;
            const product = allProducts.find(p => p.id === productId);
            if(!product) {
                productDetailContent.innerHTML = `<div class="col-span-full text-center text-red-400">Product not found.</div>`;
                return;
            }

            // Fetch variants for this product
            const variantsRef = collection(db, `products/${productId}/variants`);
            const variantSnapshot = await getDocs(variantsRef);
            currentProductVariants = variantSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), productId, productName: product.name, productImageUrl: product.imageUrl }));
            
            if (currentProductVariants.length === 0) {
                 productDetailContent.innerHTML = `<div class="col-span-full text-center text-gray-400">No options available for this product yet.</div>`;
                 return;
            }

            const sizes = [...new Set(currentProductVariants.map(v => v.size))];
            let selectedSize = sizes[0];
            
            const renderDetails = () => {
                const variantsForSize = currentProductVariants.filter(v => v.size === selectedSize);
                const flavours = variantsForSize.map(v => v.flavour);
                let selectedFlavour = flavours[0];

                const updateSelection = () => {
                    const selectedVariant = currentProductVariants.find(v => v.size === selectedSize && v.flavour === selectedFlavour);
                    
                    document.getElementById('product-price').textContent = `₹${selectedVariant.price.toLocaleString('en-IN')}`;
                    const stockIndicator = document.getElementById('stock-indicator');
                    const addToCartBtn = document.getElementById('detail-add-to-cart-btn');

                    if(selectedVariant.inStock) {
                        stockIndicator.innerHTML = `<span class="text-green-400 font-semibold">In Stock</span>`;
                        addToCartBtn.disabled = false;
                        addToCartBtn.textContent = 'Add to Cart';
                    } else {
                        stockIndicator.innerHTML = `<span class="text-red-400 font-semibold">Out of Stock</span>`;
                        addToCartBtn.disabled = true;
                        addToCartBtn.textContent = 'Out of Stock';
                    }
                    addToCartBtn.onclick = () => addToCart(selectedVariant);
                };

                const sizeButtonsHtml = sizes.map(s => `<button class="size-btn border-2 border-gray-600 rounded-lg px-4 py-2 transition-colors duration-300 ${s === selectedSize ? 'active' : ''}" data-size="${s}">${s}</button>`).join('');
                
                const flavourOptionsHtml = flavours.map(f => `<option value="${f}">${f}</option>`).join('');

                productDetailContent.innerHTML = `
                    <div>
                        <img id="main-product-image" src="${product.imageUrl}" alt="${product.name}" class="w-full rounded-lg shadow-lg">
                    </div>
                    <div>
                        <h1 class="text-3xl lg:text-4xl font-bold text-white mb-2">${product.name}</h1>
                        <p class="text-gray-400 mb-4">${product.category}</p>
                        <p class="text-gray-300 leading-relaxed mb-6">${product.description}</p>
                        
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-300 mb-3">Pack Size</h3>
                            <div id="size-selector" class="flex flex-wrap gap-3">${sizeButtonsHtml}</div>
                        </div>

                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-300 mb-3">Flavour</h3>
                            <select id="flavour-selector" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500">${flavourOptionsHtml}</select>
                        </div>
                        
                        <div class="flex items-center justify-between my-8">
                            <span id="product-price" class="text-4xl font-bold text-cyan-400"></span>
                            <div id="stock-indicator"></div>
                        </div>

                        <button id="detail-add-to-cart-btn" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-4 px-4 rounded-lg transition duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed">Add to Cart</button>
                    </div>
                `;

                document.getElementById('size-selector').addEventListener('click', e => {
                    const btn = e.target.closest('.size-btn');
                    if(btn) {
                        selectedSize = btn.dataset.size;
                        renderDetails();
                    }
                });

                 document.getElementById('flavour-selector').addEventListener('change', e => {
                    selectedFlavour = e.target.value;
                    updateSelection();
                });
                updateSelection();
            };

            renderDetails();
        };

        const filterAndRenderProducts = () => {
            let filteredProducts = allProducts;
            if (currentCategory !== 'All') {
                filteredProducts = filteredProducts.filter(p => p.category === currentCategory);
            }
            if (currentSearchTerm) {
                filteredProducts = filteredProducts.filter(p => p.name.toLowerCase().includes(currentSearchTerm));
            }
            renderShopProducts(filteredProducts);
        };

        const renderCategoryFilters = () => {
            const categories = ['All', ...new Set(allProducts.map(p => p.category))];
            categoryFilters.innerHTML = categories.map(cat => 
                `<button class="category-btn text-gray-300 bg-gray-800 hover:bg-cyan-600 hover:text-white font-semibold py-2 px-4 rounded-lg transition duration-300 ${cat === 'All' ? 'active' : ''}" data-category="${cat}">${cat}</button>`
            ).join('');
        };
        
        const renderAdminProducts = (products) => {
            adminProductList.innerHTML = '';
            if (products.length === 0) { adminProductList.innerHTML = `<p class="text-gray-400 text-center">No products found.</p>`; return; }
            products.forEach(product => {
                const item = document.createElement('div');
                item.className = "bg-gray-700 p-4 rounded-lg flex items-center justify-between gap-4";
                item.innerHTML = `
                    <div class="flex items-center gap-4 flex-grow">
                        <img src="${product.imageUrl}" alt="${product.name}" class="w-16 h-16 object-cover rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/64x64/1f2937/FFFFFF?text=Img';">
                        <div class="flex-grow">
                            <p class="font-semibold text-white">${product.name}</p>
                            <p class="text-sm text-gray-400">${product.category}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button data-id="${product.id}" class="manage-variants-btn bg-cyan-600 hover:bg-cyan-700 text-white font-semibold py-2 px-4 rounded-lg">Manage Variants</button>
                        <button data-id="${product.id}" class="edit-product-btn text-gray-300 hover:text-white"><i data-lucide="edit"></i></button>
                        <button data-id="${product.id}" class="delete-product-btn text-red-400 hover:text-red-500"><i data-lucide="trash-2"></i></button>
                    </div>`;
                adminProductList.appendChild(item);
            });
            lucide.createIcons();
        };

        const renderSkeletons = () => { productGrid.innerHTML = Array(4).fill('').map(() => `<div class="bg-gray-800 rounded-lg p-6 animate-pulse"><div class="h-48 bg-gray-700 rounded"></div><div class="h-6 bg-gray-700 rounded mt-4 w-3/4"></div><div class="h-4 bg-gray-700 rounded mt-2 w-1/2"></div><div class="h-8 bg-gray-700 rounded mt-4 w-1/4"></div></div>`).join(''); };

        // --- DATABASE INTERACTIONS ---
        const saveProduct = async (productData, id) => {
            try {
                const docRef = id ? doc(db, 'products', id) : doc(collection(db, 'products'));
                await setDoc(docRef, productData);
                showToast(`Product ${id ? 'updated' : 'added'} successfully!`);
                closeAdminProductModal();
            } catch(e) {
                console.error(e);
                showToast('Failed to save product.', true);
            }
        };

        const deleteProduct = async (productId) => {
            try {
                // Also delete subcollection of variants
                const variantsRef = collection(db, `products/${productId}/variants`);
                const variantSnapshot = await getDocs(variantsRef);
                const batch = writeBatch(db);
                variantSnapshot.docs.forEach(doc => batch.delete(doc.ref));
                await batch.commit();

                await deleteDoc(doc(db, 'products', productId));
                showToast('Product and its variants deleted successfully!');
            } catch (e) {
                console.error(e);
                showToast('Failed to delete product.', true);
            }
        };
        
        const saveVariant = async (productId, variantData, id) => {
            try {
                const docRef = id ? doc(db, `products/${productId}/variants`, id) : doc(collection(db, `products/${productId}/variants`));
                await setDoc(docRef, { ...variantData, price: Number(variantData.price) });
                showToast(`Variant ${id ? 'updated' : 'added'} successfully!`);
                openAdminVariantModal(productId); // Refresh the variant modal
            } catch(e) {
                console.error(e);
                showToast('Failed to save variant.', true);
            }
        };

        const deleteVariant = async (productId, variantId) => {
             try {
                await deleteDoc(doc(db, `products/${productId}/variants`, variantId));
                showToast('Variant deleted successfully!');
                openAdminVariantModal(productId); // Refresh
            } catch (e) {
                console.error(e);
                showToast('Failed to delete variant.', true);
            }
        };

        const updateOrderStatus = async (id, status) => { try { const orderRef = doc(db, ordersCollection.path, id); await updateDoc(orderRef, { status }); showToast('Order status updated!'); } catch (e) { console.error(e); showToast('Failed to update status.', true); }};

        // --- ADMIN MODALS ---
        const openAdminProductModal = (product = null) => {
            const modal = document.getElementById('admin-product-modal');
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-lg p-8 relative no-scrollbar overflow-y-auto max-h-screen">
                    <button id="close-product-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x"></i></button>
                    <h2 class="text-2xl font-bold text-cyan-400 mb-6">${product ? 'Edit Product' : 'Add New Product'}</h2>
                    <form id="add-product-form" class="space-y-4">
                        <input type="hidden" id="productId" value="${product?.id || ''}">
                        <div><label for="productName" class="block text-sm font-medium text-gray-300">Product Name</label><input type="text" id="productName" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white px-3 py-2" value="${product?.name || ''}" required></div>
                        <div><label for="productDescription" class="block text-sm font-medium text-gray-300">Description</label><textarea id="productDescription" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white px-3 py-2" required>${product?.description || ''}</textarea></div>
                        <div><label for="productImage" class="block text-sm font-medium text-gray-300">Image URL</label><input type="text" id="productImage" placeholder="https://placehold.co/400x400/..." class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white px-3 py-2" value="${product?.imageUrl || ''}" required></div>
                        <div><label for="productCategory" class="block text-sm font-medium text-gray-300">Category</label><select id="productCategory" class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white px-3 py-2" required><option>Protein</option><option>Mass Gainer</option><option>Creatine</option><option>Pre-Workout</option><option>Vitamins</option><option>Other</option></select></div>
                        <button type="submit" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 rounded-lg transition duration-300">${product ? 'Save Changes' : 'Add Product'}</button>
                    </form>
                </div>
            `;
            if (product) document.getElementById('productCategory').value = product.category;
            modal.classList.remove('hidden'); modal.classList.add('flex');
            lucide.createIcons();
            document.getElementById('close-product-modal').addEventListener('click', closeAdminProductModal);
            document.getElementById('add-product-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const productData = {
                    name: document.getElementById('productName').value,
                    description: document.getElementById('productDescription').value,
                    imageUrl: document.getElementById('productImage').value,
                    category: document.getElementById('productCategory').value
                };
                saveProduct(productData, document.getElementById('productId').value);
            });
        };
        const closeAdminProductModal = () => document.getElementById('admin-product-modal').classList.add('hidden');

        const openAdminVariantModal = async (productId) => {
            const product = allProducts.find(p => p.id === productId);
            const modal = document.getElementById('admin-variant-modal');
            modal.classList.remove('hidden'); modal.classList.add('flex');
            modal.innerHTML = `<div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-3xl p-8 relative no-scrollbar overflow-y-auto max-h-screen"><p>Loading variants...</p></div>`;
            
            const variantsRef = collection(db, `products/${productId}/variants`);
            const variantSnapshot = await getDocs(variantsRef);
            const variants = variantSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-3xl p-8 relative no-scrollbar overflow-y-auto max-h-screen">
                    <button id="close-variant-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i data-lucide="x"></i></button>
                    <h2 class="text-2xl font-bold text-cyan-400 mb-2">Manage Variants for ${product.name}</h2>
                    <p class="text-gray-400 mb-6">Add available sizes, flavors, and prices for this product.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">Add New Variant</h3>
                            <form id="add-variant-form" class="space-y-4">
                                <div><label class="block text-sm font-medium text-gray-300">Size</label><input type="text" id="variantSize" placeholder="e.g., 1kg" class="mt-1 w-full bg-gray-700 rounded-md text-white px-3 py-2" required></div>
                                <div><label class="block text-sm font-medium text-gray-300">Flavour</label><input type="text" id="variantFlavour" placeholder="e.g., Chocolate" class="mt-1 w-full bg-gray-700 rounded-md text-white px-3 py-2" required></div>
                                <div><label class="block text-sm font-medium text-gray-300">Price (₹)</label><input type="number" id="variantPrice" class="mt-1 w-full bg-gray-700 rounded-md text-white px-3 py-2" required></div>
                                <div class="flex items-center"><input type="checkbox" id="variantInStock" class="h-4 w-4 rounded" checked><label class="ml-2 text-sm text-gray-300">In Stock</label></div>
                                <button type="submit" class="w-full bg-cyan-500 hover:bg-cyan-600 font-bold py-2 px-4 rounded-lg">Add Variant</button>
                            </form>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">Existing Variants</h3>
                            <div id="variant-list" class="space-y-3 max-h-96 overflow-y-auto no-scrollbar">
                                ${variants.length > 0 ? variants.map(v => `
                                    <div class="bg-gray-700 p-3 rounded-lg flex justify-between items-center">
                                        <div>
                                            <p class="font-semibold">${v.size} - ${v.flavour}</p>
                                            <p class="text-sm text-gray-300">₹${v.price} - <span class="${v.inStock ? 'text-green-400' : 'text-red-400'}">${v.inStock ? 'In Stock' : 'Out of Stock'}</span></p>
                                        </div>
                                        <button data-id="${v.id}" class="delete-variant-btn text-red-400 hover:text-red-500"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                                    </div>
                                `).join('') : '<p class="text-gray-400">No variants added yet.</p>'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
            document.getElementById('close-variant-modal').addEventListener('click', closeAdminVariantModal);
            document.getElementById('add-variant-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const variantData = {
                    size: document.getElementById('variantSize').value,
                    flavour: document.getElementById('variantFlavour').value,
                    price: document.getElementById('variantPrice').value,
                    inStock: document.getElementById('variantInStock').checked
                };
                saveVariant(productId, variantData);
            });
            document.getElementById('variant-list').addEventListener('click', async e => {
                const btn = e.target.closest('.delete-variant-btn');
                if (btn) {
                    const confirmed = await confirmAction({title: 'Delete Variant?', text: 'This variant will be permanently deleted.'});
                    if(confirmed) deleteVariant(productId, btn.dataset.id);
                }
            });
        };
        const closeAdminVariantModal = () => document.getElementById('admin-variant-modal').classList.add('hidden');


        // --- ORDER MANAGEMENT ---
        const renderAdminOrders = (orders) => {
            adminOrderList.innerHTML = '';
            if(orders.length === 0) { adminOrderList.innerHTML = `<p class="text-gray-400 text-center">No orders yet.</p>`; return; }
            orders.forEach(order => {
                const item = document.createElement('div');
                item.className = "bg-gray-700 p-4 rounded-lg";
                const orderDate = order.timestamp?.toDate().toLocaleString() || 'N/A';
                const itemsHtml = order.items.map(p => `<li>${p.name} (${p.size}, ${p.flavour}) x${p.quantity}</li>`).join('');
                item.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold text-white">Order ID: ${order.id.substring(0, 8)}</p>
                            <p class="text-sm text-gray-400">${orderDate}</p>
                            <p class="mt-2">${order.customer.name} - ${order.customer.email}</p>
                        </div>
                         <div class="text-right">
                            <p class="text-xl font-bold text-cyan-400">₹${order.total.toLocaleString('en-IN')}</p>
                            <select class="order-status-select bg-gray-800 border-gray-600 rounded-md shadow-sm text-white px-3 py-1 mt-2" data-id="${order.id}">
                                <option ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                <option ${order.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                                <option ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                                <option ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                            </select>
                         </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-600">
                        <p class="font-semibold">Items:</p>
                        <ul class="list-disc list-inside text-gray-300">${itemsHtml}</ul>
                    </div>`;
                adminOrderList.appendChild(item);
            });
        };

        const renderCustomerOrders = (orders) => {
            customerOrderList.innerHTML = '';
            if(orders.length === 0) { 
                customerOrderList.innerHTML = `<p class="text-gray-400 text-center">No orders found for this email.</p>`; 
                return; 
            }
            orders.forEach(order => {
                const item = document.createElement('div');
                item.className = "bg-gray-800 p-6 rounded-lg";
                const orderDate = order.timestamp?.toDate().toLocaleString() || 'N/A';
                const itemsHtml = order.items.map(p => `<li>${p.name} (${p.size}, ${p.flavour}) x${p.quantity} - ₹${(p.price || 0).toLocaleString('en-IN')}</li>`).join('');
                
                let statusColor = 'text-yellow-400';
                if (order.status === 'Delivered') statusColor = 'text-green-400';
                if (order.status === 'Shipped') statusColor = 'text-blue-400';
                if (order.status === 'Cancelled') statusColor = 'text-red-400';

                item.innerHTML = `
                    <div class="flex flex-col sm:flex-row justify-between sm:items-start gap-4">
                        <div>
                            <p class="font-bold text-white text-lg">Order ID: <span class="font-normal text-gray-300">${order.id.substring(0, 8)}</span></p>
                            <p class="text-sm text-gray-400">${orderDate}</p>
                        </div>
                         <div class="text-left sm:text-right">
                            <p class="text-xl font-bold text-cyan-400">₹${order.total.toLocaleString('en-IN')}</p>
                            <p class="font-semibold mt-1 ${statusColor}">Status: ${order.status}</p>
                         </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-700">
                        <p class="font-semibold text-white mb-2">Items:</p>
                        <ul class="list-disc list-inside text-gray-300 space-y-1">${itemsHtml}</ul>
                    </div>`;
                customerOrderList.appendChild(item);
            });
        };
        
        // --- PAYMENT LOGIC ---
        const handlePayment = async (e) => {
            e.preventDefault();
            const customerDetails = {
                name: document.getElementById('customerName').value,
                email: document.getElementById('customerEmail').value,
                phone: document.getElementById('customerPhone').value
            };
            const totalAmount = calculateSubtotal();

            const options = {
                "key": "YOUR_RAZORPAY_KEY_ID", // <-- IMPORTANT: Replace this with your actual Razorpay Key ID!
                "amount": totalAmount * 100,
                "currency": "INR",
                "name": "Ajay's Nutrition",
                "description": "Order Payment",
                "image": "https://placehold.co/100x100/111827/FFFFFF?text=AN",
                "handler": async (response) => { 
                    const orderItems = cart.map(item => ({ 
                        name: item.name, 
                        quantity: item.quantity, 
                        price: item.price,
                        size: item.size,
                        flavour: item.flavour
                    }));
                    try {
                        await addDoc(ordersCollection, {
                            razorpayPaymentId: response.razorpay_payment_id,
                            customer: customerDetails,
                            items: orderItems,
                            total: totalAmount,
                            status: 'Pending',
                            timestamp: serverTimestamp()
                        });
                        showToast(`Payment successful!`); 
                        cart = []; 
                        updateCart(); 
                        closeCheckout();
                    } catch (err) {
                        console.error("Error saving order:", err);
                        showToast('Payment successful, but failed to save order.', true);
                    }
                },
                "prefill": { "name": customerDetails.name, "email": customerDetails.email, "contact": customerDetails.phone },
                "theme": { "color": "#22d3ee" }
            };
            const rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', (response) => { showToast(`Payment failed: ${response.error.description}`, true); });
            rzp1.open();
        };

        const handleCustomerLookup = async (e) => {
            e.preventDefault();
            const lookupError = document.getElementById('customer-lookup-error');
            lookupError.classList.add('hidden');
            const email = document.getElementById('customerLookupEmail').value.trim();
            if (!email) return;

            try {
                const q = query(ordersCollection, where("customer.email", "==", email));
                const querySnapshot = await getDocs(q);
                let orders = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Sort orders by timestamp client-side
                orders.sort((a, b) => {
                    const timeA = a.timestamp ? a.timestamp.toMillis() : 0;
                    const timeB = b.timestamp ? b.timestamp.toMillis() : 0;
                    return timeB - timeA;
                });

                if (orders.length > 0) {
                    renderCustomerOrders(orders);
                    customerLookupScreen.classList.add('hidden');
                    customerOrdersScreen.classList.remove('hidden');
                } else {
                    lookupError.classList.remove('hidden');
                }
            } catch (error) {
                console.error("Error looking up orders:", error);
                showToast('Could not fetch orders. Please try again later.', true);
            }
        };

        // --- EVENT LISTENERS ---
        document.getElementById('admin-login-link').addEventListener('click', (e) => { e.preventDefault(); switchView('admin-view'); });
        [...document.querySelectorAll('[id^="back-to-shop-"]')].forEach(btn => btn.addEventListener('click', () => switchView('shop-view')));
        document.getElementById('my-orders-link').addEventListener('click', (e) => { e.preventDefault(); switchView('customer-view'); });
        document.getElementById('mobile-my-orders-link').addEventListener('click', (e) => { e.preventDefault(); switchView('customer-view'); mobileMenu.classList.add('hidden'); });
        document.getElementById('customer-lookup-form').addEventListener('submit', handleCustomerLookup);
        document.getElementById('back-to-products-grid').addEventListener('click', () => switchView('shop-view'));
        document.getElementById('lookup-another-email-btn').addEventListener('click', () => {
            customerOrdersScreen.classList.add('hidden');
            customerLookupScreen.classList.remove('hidden');
            document.getElementById('customerLookupEmail').value = '';
            document.getElementById('customer-lookup-error').classList.add('hidden');
        });

        document.getElementById('login-form').addEventListener('submit', (e) => { e.preventDefault(); if (document.getElementById('password').value === 'admin123') { sessionStorage.setItem('isAdminLoggedIn', 'true'); showDashboard(); } else { document.getElementById('login-error').classList.remove('hidden'); } });
        document.getElementById('logout-button').addEventListener('click', () => { sessionStorage.removeItem('isAdminLoggedIn'); document.getElementById('password').value = ''; showLoginScreen(); });
        
        document.getElementById('add-new-product-btn').addEventListener('click', () => openAdminProductModal());
        
        adminProductList.addEventListener('click', async (e) => { 
            const deleteBtn = e.target.closest('.delete-product-btn'); 
            const editBtn = e.target.closest('.edit-product-btn');
            const variantsBtn = e.target.closest('.manage-variants-btn');

            if (deleteBtn) { const confirmed = await confirmAction({ title: 'Delete Product?', text: 'This will delete the product and ALL its variants permanently.' }); if (confirmed) { deleteProduct(deleteBtn.dataset.id); } } 
            if (editBtn) { 
                const product = allProducts.find(p => p.id === editBtn.dataset.id);
                openAdminProductModal(product);
            }
            if (variantsBtn) { openAdminVariantModal(variantsBtn.dataset.id); }
        });
        document.getElementById('cart-button').addEventListener('click', openCart);
        document.getElementById('close-cart-button').addEventListener('click', closeCart);
        document.getElementById('cart-overlay').addEventListener('click', closeCart);
        document.getElementById('checkout-button').addEventListener('click', () => { closeCart(); openCheckout(); });
        document.getElementById('close-checkout-button').addEventListener('click', closeCheckout);
        document.getElementById('checkout-form').addEventListener('submit', handlePayment);
        cartItemsContainer.addEventListener('click', (e) => { const qBtn = e.target.closest('.quantity-change'); const rBtn = e.target.closest('.remove-item'); if (qBtn) { changeQuantity(qBtn.dataset.id, parseInt(qBtn.dataset.change)); } if (rBtn) { removeFromCart(rBtn.dataset.id); } });
        
        document.getElementById('mobile-menu-button').addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        document.querySelectorAll('.mobile-menu-link').forEach(link => link.addEventListener('click', () => mobileMenu.classList.add('hidden')));
        categoryFilters.addEventListener('click', (e) => { 
            const btn = e.target.closest('.category-btn');
            if(btn) { 
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCategory = btn.dataset.category;
                filterAndRenderProducts();
            }
        });
        const handleSearch = (e) => { currentSearchTerm = e.target.value.toLowerCase(); filterAndRenderProducts(); };
        searchBar.addEventListener('keyup', handleSearch);
        mobileSearchBar.addEventListener('keyup', handleSearch);

        // Admin Tabs Listener
        const switchAdminTab = (tab) => {
            if(tab === 'orders') {
                tabOrders.classList.add('text-cyan-400', 'border-cyan-400');
                tabOrders.classList.remove('text-gray-400', 'hover:text-white');
                tabProducts.classList.remove('text-cyan-400', 'border-cyan-400');
                tabProducts.classList.add('text-gray-400', 'hover:text-white');
                contentOrders.classList.remove('hidden');
                contentProducts.classList.add('hidden');
            } else {
                tabProducts.classList.add('text-cyan-400', 'border-cyan-400');
                tabProducts.classList.remove('text-gray-400', 'hover:text-white');
                tabOrders.classList.remove('text-cyan-400', 'border-cyan-400');
                tabOrders.classList.add('text-gray-400', 'hover:text-white');
                contentProducts.classList.remove('hidden');
                contentOrders.classList.add('hidden');
            }
        };
        tabProducts.addEventListener('click', () => switchAdminTab('products'));
        tabOrders.addEventListener('click', () => switchAdminTab('orders'));
        adminOrderList.addEventListener('change', e => {
            const select = e.target.closest('.order-status-select');
            if (select) { updateOrderStatus(select.dataset.id, select.value); }
        });

        // --- INITIALIZATION LOGIC ---
        document.addEventListener('DOMContentLoaded', async () => {
            lucide.createIcons();
            renderSkeletons();
            updateCart();
            switchView('shop-view');
            
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                await signInAnonymously(auth);
                
                productsCollection = collection(db, "products");
                ordersCollection = collection(db, "orders");

                onSnapshot(query(productsCollection, orderBy("name")), async (snapshot) => {
                    const productPromises = snapshot.docs.map(async (doc) => {
                        const productData = { id: doc.id, ...doc.data() };
                        
                        // Find the minimum price among variants for display
                        const variantsRef = collection(db, `products/${doc.id}/variants`);
                        const variantSnapshot = await getDocs(query(variantsRef, orderBy("price", "asc")));
                        if (!variantSnapshot.empty) {
                            productData.minPrice = variantSnapshot.docs[0].data().price;
                        } else {
                            productData.minPrice = null;
                        }
                        return productData;
                    });

                    allProducts = await Promise.all(productPromises);
                    
                    filterAndRenderProducts();
                    renderAdminProducts(allProducts);
                    renderCategoryFilters();
                });

                const ordersQuery = query(ordersCollection, orderBy("timestamp", "desc"));
                onSnapshot(ordersQuery, (snapshot) => {
                    const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderAdminOrders(orders);
                });

            } catch (error) {
                console.error("Initialization failed:", error);
                productGrid.innerHTML = `<div class="col-span-full text-center p-6 bg-red-900/20 border border-red-500 rounded-lg"><p class="text-red-400">Could not connect to the database. Please check your Firebase configuration and security rules.</p></div>`;
            }

            if (sessionStorage.getItem('isAdminLoggedIn') === 'true') { showDashboard(); } else { showLoginScreen(); }
        });
    </script>
</body>
</html>


